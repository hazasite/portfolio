<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin | HAZA</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;800&family=Space+Grotesk:wght@300;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Outfit', sans-serif;
            background-color: #050505;
            color: white;
            padding-bottom: 50px;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }
        input, select, textarea {
            background: rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.1);
            color: white;
            transition: all 0.3s;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #22d3ee; /* Cyan */
            box-shadow: 0 0 10px rgba(34, 211, 238, 0.2);
        }
    </style>
</head>
<body class="min-h-screen">

    <!-- Navigation -->
    <nav class="w-full px-6 py-4 glass-panel border-b border-white/10 mb-10">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <span class="text-2xl font-bold tracking-widest text-white">HAZA<span class="text-cyan-400">.ADMIN</span></span>
            <a href="index.html" class="text-sm text-gray-400 hover:text-white transition-colors">Back to Home</a>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <!-- Left Column: Add/Edit Form -->
        <div class="lg:col-span-1">
            <div class="glass-panel p-6 rounded-2xl sticky top-6">
                <h2 id="form-title" class="text-2xl font-bold mb-6 text-cyan-400">Add New Project</h2>
                
                <form id="project-form" class="space-y-4">
                    <input type="hidden" id="project-id">
                    
                    <div>
                        <label class="block text-xs font-bold text-gray-400 mb-1">Title</label>
                        <input type="text" id="title" required class="w-full px-4 py-2 rounded-lg" placeholder="Project Name">
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-gray-400 mb-1">Category</label>
                        <select id="category" required class="w-full px-4 py-2 rounded-lg">
                            <option value="template">Website Template</option>
                            <option value="mobile">Mobile App</option>
                            <option value="desktop">Desktop App</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-gray-400 mb-1">Image URL</label>
                        <input type="url" id="image" required class="w-full px-4 py-2 rounded-lg" placeholder="https://...">
                        <p class="text-[10px] text-gray-500 mt-1">Use a direct image link</p>
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-gray-400 mb-1">Demo/Link URL</label>
                        <input type="url" id="link" class="w-full px-4 py-2 rounded-lg" placeholder="https://...">
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-gray-400 mb-1">Description</label>
                        <textarea id="description" rows="3" required class="w-full px-4 py-2 rounded-lg" placeholder="Short description..."></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-xs font-bold text-gray-400 mb-1">Tags (comma separated)</label>
                        <input type="text" id="tags" class="w-full px-4 py-2 rounded-lg" placeholder="HTML, CSS, React">
                    </div>

                    <div class="pt-2 flex gap-2">
                        <button type="submit" class="flex-1 bg-cyan-500 hover:bg-cyan-400 text-black font-bold py-2 rounded-lg transition-colors">
                            Save Project
                        </button>
                        <button type="button" id="cancel-edit" onclick="resetForm()" class="hidden px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Right Column: Project List & Options -->
        <div class="lg:col-span-2">
            <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                <h2 class="text-2xl font-bold text-white">Manage Projects</h2>
                
                <!-- Filter Options -->
                <div class="flex gap-2 w-full md:w-auto">
                    <select id="filter-category" onchange="filterProjects()" class="bg-gray-800 border border-gray-600 text-sm rounded-lg px-3 py-2 focus:border-cyan-500 outline-none">
                        <option value="all">All Categories</option>
                        <option value="template">Templates</option>
                        <option value="mobile">Mobile</option>
                        <option value="desktop">Desktop</option>
                    </select>
                    <input type="text" id="search-input" oninput="filterProjects()" placeholder="Search projects..." class="flex-1 bg-gray-800 border border-gray-600 text-sm rounded-lg px-3 py-2 focus:border-cyan-500 outline-none placeholder-gray-500">
                </div>
            </div>

            <div id="project-list" class="space-y-4">
                <!-- Projects will be loaded here via JS -->
                <div class="text-center py-10 text-gray-500">Loading projects...</div>
            </div>
        </div>

    </div>

    <!-- Firebase Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc, query, orderBy, getDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBn4ldJk9b7pCLBE37B_olzh0R29incdC8",
            authDomain: "portfolio-93741.firebaseapp.com",
            projectId: "portfolio-93741",
            storageBucket: "portfolio-93741.firebasestorage.app",
            messagingSenderId: "473337492134",
            appId: "1:473337492134:web:85cef29a2ce62b49a33a67",
            measurementId: "G-WWTTS5TRFX"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const projectsRef = collection(db, "projects");

        const form = document.getElementById('project-form');
        const listContainer = document.getElementById('project-list');
        const formTitle = document.getElementById('form-title');
        const cancelBtn = document.getElementById('cancel-edit');

        // Cache for filtering
        let projectsCache = [];

        // --- LOAD PROJECTS ---
        async function loadProjects() {
            const q = query(projectsRef, orderBy("title")); 
            const querySnapshot = await getDocs(q);
            projectsCache = []; // Reset cache
            listContainer.innerHTML = '';
            
            if(querySnapshot.empty) {
                listContainer.innerHTML = '<div class="text-center text-gray-500">No projects found. Add one!</div>';
                return;
            }

            querySnapshot.forEach((doc) => {
                const data = doc.data();
                data.id = doc.id; // Attach ID for easier filtering
                projectsCache.push(data);
            });

            renderList(projectsCache);
        }

        // --- RENDER LIST ---
        function renderList(projects) {
            listContainer.innerHTML = '';
            if(projects.length === 0) {
                listContainer.innerHTML = '<div class="text-center text-gray-500">No matching projects found.</div>';
                return;
            }

            projects.forEach((data) => {
                // Create Card Element
                const card = document.createElement('div');
                card.className = "glass-panel p-4 rounded-xl flex flex-col md:flex-row gap-4 items-center group";
                
                // Dynamic Color based on category
                let catColor = "text-gray-300";
                let catBg = "bg-gray-700";
                if(data.category === 'template') { catColor = "text-emerald-400"; catBg = "bg-emerald-900/30 border-emerald-500/30"; }
                if(data.category === 'mobile') { catColor = "text-cyan-400"; catBg = "bg-cyan-900/30 border-cyan-500/30"; }
                if(data.category === 'desktop') { catColor = "text-purple-400"; catBg = "bg-purple-900/30 border-purple-500/30"; }

                card.innerHTML = `
                    <img src="${data.image || 'https://via.placeholder.com/100'}" class="w-20 h-20 object-cover rounded-lg border border-white/10" alt="thumb">
                    <div class="flex-1 w-full">
                        <div class="flex justify-between items-start">
                            <div>
                                <span class="text-[10px] uppercase tracking-wider font-bold px-2 py-0.5 rounded border ${catBg} ${catColor}">${data.category}</span>
                                <h3 class="text-lg font-bold text-white mt-1">${data.title}</h3>
                                <p class="text-sm text-gray-400 line-clamp-1">${data.description}</p>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="window.editProject('${data.id}')" class="p-2 text-blue-400 hover:bg-blue-500/20 rounded-lg transition-colors" title="Edit">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                                </button>
                                <button onclick="window.deleteProject('${data.id}')" class="p-2 text-red-400 hover:bg-red-500/20 rounded-lg transition-colors" title="Delete">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                listContainer.appendChild(card);
            });
        }

        // --- FILTER FUNCTION ---
        window.filterProjects = () => {
            const searchText = document.getElementById('search-input').value.toLowerCase();
            const categoryFilter = document.getElementById('filter-category').value;

            const filtered = projectsCache.filter(p => {
                const matchesSearch = p.title.toLowerCase().includes(searchText) || p.description.toLowerCase().includes(searchText);
                const matchesCategory = categoryFilter === 'all' || p.category === categoryFilter;
                return matchesSearch && matchesCategory;
            });

            renderList(filtered);
        };

        // --- ADD / UPDATE PROJECT ---
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const id = document.getElementById('project-id').value;
            const projectData = {
                title: document.getElementById('title').value,
                category: document.getElementById('category').value,
                image: document.getElementById('image').value,
                link: document.getElementById('link').value,
                description: document.getElementById('description').value,
                tags: document.getElementById('tags').value.split(',').map(t => t.trim()),
                timestamp: new Date() // Updates timestamp on edit too
            };

            try {
                if (id) {
                    // Update
                    await updateDoc(doc(db, "projects", id), projectData);
                    alert("Project Updated!");
                } else {
                    // Add New
                    await addDoc(projectsRef, projectData);
                    alert("Project Added!");
                }
                resetForm();
                loadProjects();
            } catch (error) {
                console.error("Error: ", error);
                alert("Error saving project. Check console.");
            }
        });

        // --- GLOBAL FUNCTIONS ---
        window.deleteProject = async (id) => {
            if(confirm("Are you sure you want to delete this project?")) {
                try {
                    await deleteDoc(doc(db, "projects", id));
                    loadProjects();
                } catch (error) {
                    console.error("Error deleting: ", error);
                }
            }
        };

        window.editProject = async (id) => {
            // Fetch latest data for this ID
            const docRef = doc(db, "projects", id);
            const docSnap = await getDoc(docRef);
            
            if (docSnap.exists()) {
                const data = docSnap.data();
                
                // Populate Form
                document.getElementById('project-id').value = id;
                document.getElementById('title').value = data.title || '';
                document.getElementById('category').value = data.category || 'template';
                document.getElementById('image').value = data.image || '';
                document.getElementById('link').value = data.link || '';
                document.getElementById('description').value = data.description || '';
                document.getElementById('tags').value = data.tags ? data.tags.join(', ') : '';

                // UI Changes
                formTitle.innerText = "Edit Project";
                document.querySelector('button[type="submit"]').innerText = "Update Project";
                cancelBtn.classList.remove('hidden');
                
                // Scroll to form
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else {
                alert("Error loading project data.");
            }
        };

        window.resetForm = () => {
            document.getElementById('project-form').reset();
            document.getElementById('project-id').value = '';
            formTitle.innerText = "Add New Project";
            document.querySelector('button[type="submit"]').innerText = "Save Project";
            cancelBtn.classList.add('hidden');
        };

        // Initial Load
        loadProjects();

    </script>
</body>
</html>